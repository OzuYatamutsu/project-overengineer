FROM redis:7

ENV SENTINEL_PORT="${SENTINEL_PORT:-26379}"
ENV REDIS_MASTER_HOST="${REDIS_MASTER_HOST:-localhost}"
ENV REDIS_MASTER_PORT="${REDIS_MASTER_PORT:-6379}"
ENV REDIS_MASTER_PASSWORD="${REDIS_MASTER_PASSWORD:-b4yscx92yksfyv9c}"

# Generate config file
RUN "mkdir /etc"
RUN "echo port ${SENTINEL_PORT} >> /etc/sentinel.conf"
RUN "echo sentinel monitor redis-master ${REDIS_MASTER_HOST} ${REDIS_MASTER_PORT} 2 >> /etc/sentinel.conf"
RUN "echo sentinel auth-pass redis-master ${REDIS_MASTER_PASSWORD} >> /etc/sentinel.conf"
RUN "echo sentinel down-after-milliseconds redis-master 5000 >> /etc/sentinel.conf"
RUN "echo sentinel parallel-syncs redis-master 1 >> /etc/sentinel.conf"
RUN "echo sentinel failover-timeout redis-master 10000 >> /etc/sentinel.conf"
RUN "echo sentinel resolve-hostnames yes >> /etc/sentinel.conf"

CMD sh -c "redis-server --sentinel /etc/sentinel.conf"
